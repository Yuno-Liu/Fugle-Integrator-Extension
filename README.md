# 富果整合器 - 產業鏈全視圖 (Fugle Integrator)

這是一個用於增強 [富果 Fugle](https://www.fugle.tw/) 網站功能的工具，旨在整合外部數據並優化使用者介面，讓投資者能更快速地掌握個股的產業鏈地位、機構評等與關鍵財務指標。

本專案提供兩種安裝方式：**Chrome 擴充功能 (Chrome Extension)** 與 **Tampermonkey 油猴腳本**。

## ✨ 主要功能

-   **自動整合外部數據**：自動抓取並顯示產業鏈、概念股、集團股、營收、股本等資訊。
-   **公司互動關係全視圖**：
    -   供應商、客戶、競爭對手、策略聯盟
    -   轉投資、被投資關係
    -   點擊關係企業可直接跳轉至對應的富果頁面。
-   **機構評等彙整**：
    -   顯示近 6 個月內的機構評等、目標價。
    -   自動計算目標價的最高、最低與平均值，並顯示與當前股價的乖離率。
-   **關鍵財務指標儀表板**：
    -   每股淨值 (BVPS)、股價淨值比 (PB)
    -   每股盈餘 (EPS)、本益比 (PE)
    -   殖利率、毛利率、ROE、ROA
    -   市值計算 (自動換算為億或兆)
    -   ETF 持股數據：顯示持有該股票的 ETF 清單及持股比例
    -   產能分析：工廠位置、規格、產能數量與單位
-   **便捷分析工具列**：
    -   一鍵跳轉至 WantGoo (玩股網)、CMoney、TradingView、富邦證券 (法人/主力)、Gemini AI 分析。
-   **UI 優化與自定義**：
    -   **資訊卡片**：整合上述所有資訊於一張卡片中，支援展開/收合。
    -   **位置切換**：可將資訊卡片切換為「靠右」、「靠左」懸浮或「預設」嵌入模式。
    -   **獨立視窗**：支援將資訊卡片彈出至獨立視窗，方便多螢幕使用者。
    -   **顯示開關**：可隨時隱藏或顯示資訊卡片。
-   **性能優化**：
    -   內建 30 分鐘市場數據緩存，減少冗餘 API 請求
    -   防抖動與節流機制，避免頻繁觸發渲染
    -   8 秒超時保護，防止 API 掛起影響頁面

## 🚀 安裝說明

您可以選擇以下任一種方式進行安裝：

### 方法一：Chrome 擴充功能 (推薦)

1.  下載本專案的 `ChromeExtension` 資料夾。
2.  開啟 Chrome 瀏覽器，進入「擴充功能」管理頁面 (`chrome://extensions/`)。
3.  開啟右上角的「開發人員模式」。
4.  點擊左上角的「載入未封裝項目」。
5.  選擇 `ChromeExtension` 資料夾即可完成安裝。

### 方法二：Tampermonkey 油猴腳本

1.  請先安裝 [Tampermonkey](https://www.tampermonkey.net/) 瀏覽器擴充功能。
2.  點擊 Tampermonkey 圖示，選擇「添加新腳本」。
3.  將 `Tampermonkey/FugleIntegrator.js` 檔案中的程式碼完整複製並貼上到編輯器中。
4.  按下 `Ctrl + S` 或點擊「檔案」->「儲存」即可。

### 選用功能：Gemini 自動填入提示詞

本專案包含一個額外的功能模組，用於配合富果整合器中的「Gemini」按鈕使用。
當您點擊富果頁面上的「Gemini」按鈕時，會開啟 Gemini 頁面並帶入股票代號與名稱。此功能會自動讀取網址參數並填入對話框送出，省去手動輸入的步驟。

您可以選擇以下任一種方式進行安裝：

**方法一：Chrome 擴充功能**

1.  下載本專案的 `GeminiUrlPrompt` 資料夾。
2.  開啟 Chrome 瀏覽器，進入「擴充功能」管理頁面 (`chrome://extensions/`)。
3.  開啟右上角的「開發人員模式」。
4.  點擊左上角的「載入未封裝項目」。
5.  選擇 `GeminiUrlPrompt` 資料夾即可完成安裝。

**方法二：Tampermonkey 油猴腳本**

1.  依照上述步驟開啟 Tampermonkey 新增腳本。
2.  複製 `Tampermonkey/GeminiUrlPrompt.js` 的內容。
3.  儲存腳本。

## 📖 使用說明

1.  安裝完成後，前往 [富果 Fugle](https://www.fugle.tw/) 網站並進入任一個股頁面 (例如：台積電 2330)。
2.  頁面載入後，您會在股票名稱與價格資訊附近看到新增的「資訊卡片」與「工具按鈕組」。
3.  **資訊卡片**：顯示詳細的財務與產業資訊，點擊標題列可收合/展開。
4.  **工具按鈕**：
    -   點擊分析網站按鈕可開新分頁查詢。
    -   點擊位置按鈕 (如 `➡️ 靠右`) 可切換卡片顯示位置。
    -   點擊 `❐ 彈出` 可將卡片開啟於獨立視窗。
    -   使用滑動開關可暫時隱藏資訊卡片。

## 🏗️ 技術架構

### Chrome 擴充功能 vs Tampermonkey 油猴腳本

本專案提供兩種實現方式，共享相同的商業邏輯與資料處理流程，但技術實現略有不同：

| 特性           | Chrome 擴充功能                                        | Tampermonkey 油猴腳本                               |
| -------------- | ------------------------------------------------------ | --------------------------------------------------- |
| **Fetch 方式** | 透過 Service Worker 的 `chrome.runtime.onMessage` 代理 | 直接使用 `GM_xmlhttpRequest`                        |
| **存儲方式**   | `chrome.storage.local` (同步跨設備)                    | `localStorage` (本機限定)                           |
| **兼容性**     | Chrome 88+ (Manifest V3)                               | 所有支援 Tampermonkey 的瀏覽器 (Chrome、Firefox 等) |
| **安裝方式**   | 需手動載入未封裝項目                                   | 透過 Tampermonkey 管理器安裝                        |
| **權限宣告**   | `manifest.json` 的 `host_permissions`                  | Userscript header 的 `@grant`                       |

### 核心設計模式

-   **URL 輪詢**：監聽 `popupstate` 事件與 URL 變化，偵測 SPA 頁面轉換
-   **DOM 選擇器查詢**：透過 `.card-group-header__*` 類別提取股票資訊
-   **並行資料抓取**：使用 `Promise.all()` 並行執行 19 個 API 請求，加快載入速度
-   **市場數據緩存**：快取市場指標 30 分鐘，減少冗餘 API 呼叫
-   **防抖動 & 節流**：防止導航期間的重複渲染與 API 請求
-   **localStorage 持久化**：記憶使用者的卡片位置、展開狀態、可見性設定

## 📊 資訊來源

本工具整合之數據主要來自公開網路資訊，包括但不限於：

-   **玉山證券 (E.SUN Securities)**：提供產業鏈、概念股、集團股、機構評等、關鍵財務指標等數據。
-   **富果 (Fugle)**：提供基礎股價與個股頁面框架。
-   **其他分析網站**：WantGoo、CMoney、TradingView、富邦證券等 (僅提供快速連結)。

## ⚠️ 免責聲明

-   本工具僅供個人研究與學術交流使用，**不構成任何投資建議**。
-   所有數據來源均為公開網路資訊，本工具僅進行彙整與顯示優化，不保證數據的即時性與準確性。
-   投資有風險，使用者應自行判斷並承擔風險。

## 📜 授權

本專案採用 **MIT 授權** (MIT License)。詳見 [LICENSE](LICENSE) 文件。
